# å³ä¾§é¢æ¿å®¹å™¨è®¾è®¡æ–¹æ¡ˆ v2

## æ¦‚è¿°

åœ¨å¯¹è¯é¡µé¢å³ä¾§å®ç°ä¸€ä¸ªå›ºå®šæ˜¾ç¤ºçš„é¢æ¿å®¹å™¨ï¼Œé‡‡ç”¨ Tab é¡µå½¢å¼ç»„ç»‡å¤šä¸ªåŠŸèƒ½æ¨¡å—ã€‚ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æ”¶èµ·æˆ–å±•å¼€é¢æ¿ã€‚é»˜è®¤æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¸å½“å‰ä¸“å®¶æ²Ÿé€šçš„ Topics åˆ—è¡¨ã€‚

## ç•Œé¢å¸ƒå±€

### å±•å¼€çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Chat Header                              â”‚
â”‚  [Expert Name] [Model Badge]              [Toggle Panel] [â‹®]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚  [Topics] [Debug] [Files] â”‚
â”‚                                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚         Chat Window                 â”‚  â”‚ Topic Item 1          â”‚â”‚
â”‚        (å·¦ä¾§ä¸»åŒºåŸŸ)                  â”‚  â”‚ Topic Item 2          â”‚â”‚
â”‚                                     â”‚  â”‚ Topic Item 3          â”‚â”‚
â”‚                                     â”‚  â”‚ ...                   â”‚â”‚
â”‚                                     â”‚  â”‚                       â”‚â”‚
â”‚                                     â”‚  â”‚     [Pagination]      â”‚â”‚
â”‚                                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Input Area                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ”¶èµ·çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Chat Header                              â”‚
â”‚  [Expert Name] [Model Badge]                      [â–¶ Show Panel]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                     Chat Window                                 â”‚
â”‚                    (å…¨å®½æ˜¾ç¤º)                                    â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Input Area                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ–¹æ¡ˆ

### 1. ç»„ä»¶ç»“æ„

```
frontend/src/
â”œâ”€â”€ views/
â”‚   â””â”€â”€ ChatView.vue              # ä¸»è§†å›¾ï¼ŒåŒ…å«å¸ƒå±€é€»è¾‘
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ChatWindow.vue            # å¯¹è¯çª—å£ï¼ˆå·²æœ‰ï¼‰
â”‚   â”œâ”€â”€ Pagination.vue            # é€šç”¨åˆ†é¡µç»„ä»¶ï¼ˆæ–°å»ºï¼‰
â”‚   â””â”€â”€ panel/                    # é¢æ¿ç»„ä»¶ç›®å½•
â”‚       â”œâ”€â”€ RightPanel.vue        # å³ä¾§é¢æ¿å®¹å™¨
â”‚       â”œâ”€â”€ TopicsTab.vue         # Topics åˆ—è¡¨ Tabï¼ˆé»˜è®¤ï¼‰
â”‚       â”œâ”€â”€ DebugTab.vue          # è°ƒè¯•ä¿¡æ¯ Tab
â”‚       â””â”€â”€ FilesTab.vue          # æ–‡ä»¶ç®¡ç† Tab
â””â”€â”€ stores/
    â””â”€â”€ panel.ts                  # é¢æ¿çŠ¶æ€ç®¡ç†
```

### 2. é€šç”¨åˆ†é¡µè®¾è®¡

#### 2.1 åˆ†é¡µè¯·æ±‚æ ¼å¼

```typescript
// types/index.ts ä¸­æ·»åŠ 

/**
 * ç»Ÿä¸€åˆ†é¡µæŸ¥è¯¢å‚æ•°
 * æ‰€æœ‰åˆ—è¡¨æŸ¥è¯¢ API éƒ½åº”æ”¯æŒæ­¤æ ¼å¼
 */
export interface PageQuery {
  /** å½“å‰é¡µç ï¼Œä» 1 å¼€å§‹ */
  page: number
  /** æ¯é¡µæ¡æ•°ï¼Œé»˜è®¤ 10ï¼Œæœ€å¤§ 100 */
  size: number
  /** æ’åºå­—æ®µ */
  sort_by?: string
  /** æ’åºæ–¹å‘ */
  sort_order?: 'asc' | 'desc'
}

/**
 * ç»Ÿä¸€åˆ†é¡µå“åº”æ ¼å¼
 * æ‰€æœ‰åˆ—è¡¨ API éƒ½åº”è¿”å›æ­¤æ ¼å¼
 */
export interface PageResponse<T> {
  /** æ•°æ®åˆ—è¡¨ */
  items: T[]
  /** æ€»æ¡æ•° */
  total: number
  /** å½“å‰é¡µç  */
  page: number
  /** æ¯é¡µæ¡æ•° */
  size: number
  /** æ€»é¡µæ•° */
  pages: number
}
```

#### 2.2 é€šç”¨åˆ†é¡µç»„ä»¶

```vue
<!-- components/Pagination.vue -->
<template>
  <div class="pagination" v-if="totalPages > 1">
    <button 
      class="page-btn" 
      :disabled="currentPage <= 1"
      @click="goToPage(currentPage - 1)"
    >
      â€¹
    </button>
    
    <button
      v-for="page in visiblePages"
      :key="page"
      class="page-btn"
      :class="{ active: page === currentPage }"
      @click="goToPage(page)"
    >
      {{ page }}
    </button>
    
    <button 
      class="page-btn" 
      :disabled="currentPage >= totalPages"
      @click="goToPage(currentPage + 1)"
    >
      â€º
    </button>
    
    <span class="page-info">
      {{ $t('pagination.info', { total }) }}
    </span>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'

interface Props {
  currentPage: number
  totalPages: number
  total: number
  maxVisible?: number
}

const props = withDefaults(defineProps<Props>(), {
  maxVisible: 5
})

const emit = defineEmits<{
  change: [page: number]
}>()

const visiblePages = computed(() => {
  const pages: number[] = []
  const half = Math.floor(props.maxVisible / 2)
  let start = Math.max(1, props.currentPage - half)
  let end = Math.min(props.totalPages, start + props.maxVisible - 1)
  
  if (end - start < props.maxVisible - 1) {
    start = Math.max(1, end - props.maxVisible + 1)
  }
  
  for (let i = start; i <= end; i++) {
    pages.push(i)
  }
  return pages
})

const goToPage = (page: number) => {
  if (page >= 1 && page <= props.totalPages && page !== props.currentPage) {
    emit('change', page)
  }
}
</script>
```

#### 2.3 åˆ†é¡µç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

```vue
<template>
  <div class="list-container">
    <div v-for="item in items" :key="item.id">
      <!-- item content -->
    </div>
    
    <Pagination
      :current-page="pagination.page"
      :total-pages="pagination.pages"
      :total="pagination.total"
      @change="handlePageChange"
    />
  </div>
</template>

<script setup>
const pagination = ref({ page: 1, size: 10, total: 0, pages: 0 })

const loadData = async (page: number = 1) => {
  const response = await api.getList({
    page,
    size: pagination.value.size
  })
  items.value = response.items
  pagination.value = {
    page: response.page,
    size: response.size,
    total: response.total,
    pages: response.pages
  }
}

const handlePageChange = (page: number) => {
  loadData(page)
}
</script>
```

### 3. Topics Tab è®¾è®¡

#### 3.1 æ˜¾ç¤ºæ ¼å¼é€‰æ‹©

**æ¨èï¼šå¡ç‰‡åˆ—è¡¨å½¢å¼**

ç†ç”±ï¼š
- Topics é€šå¸¸åŒ…å«æ ‡é¢˜ã€æè¿°ã€æ—¶é—´ç­‰å¤šç»´åº¦ä¿¡æ¯
- å¡ç‰‡å½¢å¼æ›´æ˜“äºå±•ç¤ºè¿™äº›ä¿¡æ¯ï¼Œè§†è§‰å±‚æ¬¡æ›´æ¸…æ™°
- æ”¯æŒæ›´å¥½çš„äº¤äº’ï¼ˆç‚¹å‡»è¿›å…¥ã€hover æ•ˆæœç­‰ï¼‰
- ç§»åŠ¨ç«¯é€‚é…æ›´å‹å¥½

**æ›¿ä»£æ–¹æ¡ˆï¼šè¡¨æ ¼å½¢å¼**
- é€‚åˆæ•°æ®é‡å¤§ã€éœ€è¦å¿«é€Ÿæ‰«æå¯¹æ¯”çš„åœºæ™¯
- é€‚åˆç®¡ç†åå°åœºæ™¯

#### 3.2 TopicsTab ç»„ä»¶è®¾è®¡

```vue
<!-- components/panel/TopicsTab.vue -->
<template>
  <div class="topics-tab">
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="loading-state">
      <span class="loading-spinner"></span>
      {{ $t('common.loading') }}
    </div>
    
    <!-- ç©ºçŠ¶æ€ -->
    <div v-else-if="topics.length === 0" class="empty-state">
      <p>{{ $t('topics.noTopics') }}</p>
    </div>
    
    <!-- Topics åˆ—è¡¨ -->
    <div v-else class="topics-list">
      <div 
        v-for="topic in topics" 
        :key="topic.id"
        class="topic-card"
        :class="{ active: topic.id === activeTopicId }"
        @click="selectTopic(topic)"
      >
        <div class="topic-header">
          <h4 class="topic-title">{{ topic.title }}</h4>
          <span class="topic-date">{{ formatDate(topic.created_at) }}</span>
        </div>
        <p class="topic-description">{{ topic.description || $t('topics.noDescription') }}</p>
        <div class="topic-meta">
          <span class="meta-item">
            <span class="meta-icon">ğŸ’¬</span>
            {{ topic.message_count }} {{ $t('topics.messages') }}
          </span>
          <span class="meta-item" :class="topic.status">
            {{ $t(`topics.status.${topic.status}`) }}
          </span>
        </div>
      </div>
    </div>
    
    <!-- åˆ†é¡µ -->
    <Pagination
      v-if="pagination.pages > 1"
      :current-page="pagination.page"
      :total-pages="pagination.pages"
      :total="pagination.total"
      @change="handlePageChange"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, watch, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import Pagination from '@/components/Pagination.vue'
import { topicApi } from '@/api/services'
import type { Topic, PageResponse } from '@/types'

const route = useRoute()
const topics = ref<Topic[]>([])
const loading = ref(false)
const activeTopicId = ref<string | null>(null)

const pagination = ref({
  page: 1,
  size: 10,
  total: 0,
  pages: 0
})

// ä»è·¯ç”±è·å–å½“å‰ expertId
const expertId = computed(() => route.params.expertId as string)

// åŠ è½½ Topics
const loadTopics = async (page: number = 1) => {
  if (!expertId.value) return
  
  loading.value = true
  try {
    const response: PageResponse<Topic> = await topicApi.getTopicsByExpert(
      expertId.value,
      { page, size: pagination.value.size }
    )
    topics.value = response.items
    pagination.value = {
      page: response.page,
      size: response.size,
      total: response.total,
      pages: response.pages
    }
  } catch (error) {
    console.error('Failed to load topics:', error)
  } finally {
    loading.value = false
  }
}

// é€‰æ‹© Topic
const selectTopic = (topic: Topic) => {
  activeTopicId.value = topic.id
  // å¯ä»¥è§¦å‘åŠ è½½è¯¥ topic ä¸‹çš„æ¶ˆæ¯
  emit('select', topic)
}

// åˆ†é¡µå˜åŒ–
const handlePageChange = (page: number) => {
  loadTopics(page)
}

// ç›‘å¬ expertId å˜åŒ–
watch(expertId, (newId) => {
  if (newId) {
    loadTopics(1)
  }
}, { immediate: true })

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (dateStr: string) => {
  const date = new Date(dateStr)
  const now = new Date()
  const diff = now.getTime() - date.getTime()
  const days = Math.floor(diff / (1000 * 60 * 60 * 24))
  
  if (days === 0) return 'ä»Šå¤©'
  if (days === 1) return 'æ˜¨å¤©'
  if (days < 7) return `${days}å¤©å‰`
  return date.toLocaleDateString()
}

const emit = defineEmits<{
  select: [topic: Topic]
}>()
</script>

<style scoped>
.topics-tab {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 12px;
}

.topics-list {
  flex: 1;
  overflow-y: auto;
}

.topic-card {
  padding: 12px;
  margin-bottom: 8px;
  background: var(--card-bg, #fff);
  border: 1px solid var(--border-color, #e0e0e0);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.topic-card:hover {
  border-color: var(--primary-color, #2196f3);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.topic-card.active {
  border-color: var(--primary-color, #2196f3);
  background: var(--primary-light, #e3f2fd);
}

.topic-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 8px;
}

.topic-title {
  font-size: 14px;
  font-weight: 600;
  margin: 0;
  color: var(--text-primary, #333);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.topic-date {
  font-size: 12px;
  color: var(--text-tertiary, #999);
  flex-shrink: 0;
  margin-left: 8px;
}

.topic-description {
  font-size: 13px;
  color: var(--text-secondary, #666);
  margin: 0 0 8px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.topic-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--text-secondary, #666);
}

.meta-item.active {
  color: var(--success-color, #4caf50);
}

.meta-item.archived {
  color: var(--warning-color, #ff9800);
}
</style>
```

### 4. RightPanel å®¹å™¨è®¾è®¡

```vue
<!-- components/panel/RightPanel.vue -->
<template>
  <div class="right-panel" :class="{ collapsed: isCollapsed }">
    <!-- æŠ˜å æ—¶çš„å±•å¼€æŒ‰é’® -->
    <div v-if="isCollapsed" class="collapsed-bar" @click="togglePanel">
      <span class="expand-icon">â—€</span>
      <span class="collapsed-text">{{ $t('panel.topics') }}</span>
    </div>
    
    <!-- å±•å¼€æ—¶çš„å†…å®¹ -->
    <template v-else>
      <!-- Tab å¯¼èˆª -->
      <div class="panel-header">
        <div class="panel-tabs">
          <button 
            v-for="tab in visibleTabs" 
            :key="tab.id"
            class="tab-btn"
            :class="{ active: activeTab === tab.id }"
            @click="setActiveTab(tab.id)"
          >
            <span class="tab-icon">{{ tab.icon }}</span>
            <span class="tab-label">{{ tab.label }}</span>
          </button>
        </div>
        <button class="collapse-btn" @click="togglePanel" :title="$t('panel.collapse')">
          â–¶
        </button>
      </div>
      
      <!-- Tab å†…å®¹ -->
      <div class="panel-content">
        <TopicsTab 
          v-if="activeTab === 'topics'" 
          @select="handleTopicSelect" 
        />
        <DebugTab v-if="activeTab === 'debug'" />
        <FilesTab v-if="activeTab === 'files'" />
      </div>
    </template>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { usePanelStore } from '@/stores/panel'
import { useUserStore } from '@/stores/user'
import TopicsTab from './TopicsTab.vue'
import DebugTab from './DebugTab.vue'
import FilesTab from './FilesTab.vue'
import type { Topic } from '@/types'

const panelStore = usePanelStore()
const userStore = useUserStore()

const isCollapsed = computed(() => panelStore.isCollapsed)
const activeTab = computed(() => panelStore.activeTab)

const visibleTabs = computed(() => {
  const tabs = [
    { id: 'topics', label: 'è¯é¢˜', icon: 'ğŸ’¬' },
    { id: 'files', label: 'æ–‡ä»¶', icon: 'ğŸ“' },
    { id: 'debug', label: 'è°ƒè¯•', icon: 'ğŸ”§', adminOnly: true },
  ]
  
  return tabs.filter(tab => {
    if (tab.adminOnly && !userStore.isAdmin) {
      return false
    }
    return true
  })
})

const togglePanel = () => {
  panelStore.toggleCollapse()
}

const setActiveTab = (tabId: string) => {
  panelStore.setActiveTab(tabId)
}

const handleTopicSelect = (topic: Topic) => {
  // å¤„ç† topic é€‰æ‹©
  console.log('Selected topic:', topic)
}
</script>

<style scoped>
.right-panel {
  width: 320px;
  border-left: 1px solid var(--border-color, #e0e0e0);
  background: var(--sidebar-bg, #fff);
  display: flex;
  flex-direction: column;
  transition: width 0.3s ease;
}

.right-panel.collapsed {
  width: 40px;
}

.collapsed-bar {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 12px 4px;
  cursor: pointer;
  height: 100%;
}

.collapsed-bar:hover {
  background: var(--hover-bg, #f5f5f5);
}

.expand-icon {
  font-size: 12px;
  color: var(--text-secondary, #666);
}

.collapsed-text {
  writing-mode: vertical-rl;
  font-size: 12px;
  color: var(--text-secondary, #666);
  margin-top: 8px;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.panel-tabs {
  display: flex;
  gap: 4px;
}

.tab-btn {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 10px;
  border: none;
  background: transparent;
  border-radius: 6px;
  font-size: 13px;
  color: var(--text-secondary, #666);
  cursor: pointer;
  transition: all 0.2s;
}

.tab-btn:hover {
  background: var(--hover-bg, #f5f5f5);
}

.tab-btn.active {
  background: var(--primary-light, #e3f2fd);
  color: var(--primary-color, #2196f3);
}

.tab-icon {
  font-size: 14px;
}

.collapse-btn {
  padding: 4px 8px;
  border: none;
  background: transparent;
  color: var(--text-secondary, #666);
  cursor: pointer;
  border-radius: 4px;
}

.collapse-btn:hover {
  background: var(--hover-bg, #f5f5f5);
}

.panel-content {
  flex: 1;
  overflow: hidden;
}
</style>
```

### 5. Panel Store è®¾è®¡

```typescript
// stores/panel.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export const usePanelStore = defineStore('panel', () => {
  // State
  const isCollapsed = ref(false)
  const activeTab = ref('topics')  // é»˜è®¤æ˜¾ç¤º topics
  const width = ref(320)

  // Actions
  const toggleCollapse = () => {
    isCollapsed.value = !isCollapsed.value
    // æŒä¹…åŒ–åˆ° localStorage
    localStorage.setItem('panel_collapsed', String(isCollapsed.value))
  }

  const setActiveTab = (tabId: string) => {
    activeTab.value = tabId
    // å¦‚æœé¢æ¿æ˜¯æ”¶èµ·çš„ï¼Œå±•å¼€å®ƒ
    if (isCollapsed.value) {
      isCollapsed.value = false
    }
  }

  const setWidth = (newWidth: number) => {
    width.value = Math.min(Math.max(newWidth, 280), 600)
  }

  // åˆå§‹åŒ–æ—¶ä» localStorage æ¢å¤çŠ¶æ€
  const initFromStorage = () => {
    const collapsed = localStorage.getItem('panel_collapsed')
    if (collapsed !== null) {
      isCollapsed.value = collapsed === 'true'
    }
  }

  // è‡ªåŠ¨è°ƒç”¨åˆå§‹åŒ–
  initFromStorage()

  return {
    isCollapsed,
    activeTab,
    width,
    toggleCollapse,
    setActiveTab,
    setWidth,
  }
})
```

## åç«¯ API éœ€æ±‚

### Topics API

```
GET /api/topics?expert_id={expert_id}&page=1&size=10

Response:
{
  "items": [
    {
      "id": "uuid",
      "user_id": "uuid",
      "title": "è¯é¢˜æ ‡é¢˜",
      "description": "è¯é¢˜æè¿°",
      "expert_id": "uuid",
      "status": "active",
      "message_count": 15,
      "created_at": "2026-02-20T10:00:00Z",
      "updated_at": "2026-02-20T12:00:00Z"
    }
  ],
  "total": 45,
  "page": 1,
  "size": 10,
  "pages": 5
}
```

### é€šç”¨åˆ†é¡µæŸ¥è¯¢çº¦å®š

æ‰€æœ‰åˆ—è¡¨ API åº”éµå¾ªä»¥ä¸‹çº¦å®šï¼š

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| page | number | 1 | é¡µç ï¼Œä» 1 å¼€å§‹ |
| size | number | 10 | æ¯é¡µæ¡æ•°ï¼Œæœ€å¤§ 100 |
| sort_by | string | created_at | æ’åºå­—æ®µ |
| sort_order | string | desc | æ’åºæ–¹å‘ asc/desc |

**å“åº”æ ¼å¼ï¼š**
```json
{
  "items": [],
  "total": 0,
  "page": 1,
  "size": 10,
  "pages": 0
}
```

## å›½é™…åŒ–

```typescript
// zh-CN.ts
panel: {
  topics: 'è¯é¢˜',
  files: 'æ–‡ä»¶',
  debug: 'è°ƒè¯•',
  collapse: 'æ”¶èµ·é¢æ¿',
  expand: 'å±•å¼€é¢æ¿',
}

topics: {
  noTopics: 'æš‚æ— è¯é¢˜',
  noDescription: 'æš‚æ— æè¿°',
  messages: 'æ¡æ¶ˆæ¯',
  status: {
    active: 'è¿›è¡Œä¸­',
    archived: 'å·²å½’æ¡£',
    deleted: 'å·²åˆ é™¤',
  }
}

pagination: {
  info: 'å…± {total} æ¡',
  prev: 'ä¸Šä¸€é¡µ',
  next: 'ä¸‹ä¸€é¡µ',
}

// en-US.ts
panel: {
  topics: 'Topics',
  files: 'Files',
  debug: 'Debug',
  collapse: 'Collapse Panel',
  expand: 'Expand Panel',
}

topics: {
  noTopics: 'No topics yet',
  noDescription: 'No description',
  messages: 'messages',
  status: {
    active: 'Active',
    archived: 'Archived',
    deleted: 'Deleted',
  }
}

pagination: {
  info: '{total} total',
  prev: 'Previous',
  next: 'Next',
}
```

### 6. Docs Tab è®¾è®¡ï¼ˆé˜¶æ®µæ€§æˆæœå±•ç¤ºï¼‰

#### 6.1 åŠŸèƒ½å®šä½

Docs Tab æ˜¯å³ä¾§é¢æ¿çš„**é»˜è®¤ Tab**ï¼Œç”¨äºå±•ç¤ºå¯¹è¯è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é˜¶æ®µæ€§æˆæœæ–‡æ¡£ï¼Œå¦‚ï¼š
- AI æ’°å†™çš„æŠ¥å‘Š
- ç”Ÿæˆçš„ Markdown æ–‡æ¡£
- ä»£ç ç‰‡æ®µ
- ä¼šè®®çºªè¦
- æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£

#### 6.2 æ•°æ®ç»“æ„

```typescript
// types/index.ts ä¸­æ·»åŠ 

/**
 * é˜¶æ®µæ€§æˆæœæ–‡æ¡£
 */
export interface Doc {
  id: string
  topic_id: string
  expert_id: string
  user_id: string
  title: string
  content: string          // Markdown å†…å®¹
  content_type: 'markdown' | 'code' | 'text'
  status: 'draft' | 'final' | 'archived'
  version: number
  tags: string[]
  created_at: string
  updated_at: string
}
```

#### 6.3 DocsTab ç»„ä»¶è®¾è®¡

```vue
<!-- components/panel/DocsTab.vue -->
<template>
  <div class="docs-tab">
    <!-- å·¥å…·æ  -->
    <div class="docs-toolbar">
      <button class="btn-new-doc" @click="createNewDoc">
        <span class="icon">+</span>
        {{ $t('docs.newDoc') }}
      </button>
    </div>
    
    <!-- æ–‡æ¡£åˆ—è¡¨ -->
    <div v-if="loading" class="loading-state">
      <span class="loading-spinner"></span>
    </div>
    
    <div v-else-if="docs.length === 0" class="empty-state">
      <p>{{ $t('docs.noDocs') }}</p>
      <p class="hint">{{ $t('docs.hint') }}</p>
    </div>
    
    <div v-else class="docs-list">
      <div 
        v-for="doc in docs" 
        :key="doc.id"
        class="doc-card"
        :class="{ active: doc.id === activeDocId }"
        @click="selectDoc(doc)"
      >
        <div class="doc-header">
          <h4 class="doc-title">{{ doc.title }}</h4>
          <span class="doc-status" :class="doc.status">
            {{ $t(`docs.status.${doc.status}`) }}
          </span>
        </div>
        <p class="doc-preview">{{ getPreview(doc.content) }}</p>
        <div class="doc-meta">
          <span class="meta-item">{{ formatDate(doc.updated_at) }}</span>
          <span class="meta-item">v{{ doc.version }}</span>
        </div>
      </div>
    </div>
    
    <!-- åˆ†é¡µ -->
    <Pagination
      v-if="pagination.pages > 1"
      :current-page="pagination.page"
      :total-pages="pagination.pages"
      :total="pagination.total"
      @change="handlePageChange"
    />
    
    <!-- æ–‡æ¡£é¢„è§ˆ/ç¼–è¾‘å¼¹çª— -->
    <DocPreviewModal
      v-if="showPreview"
      :doc="selectedDoc"
      @close="closePreview"
      @save="saveDoc"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, watch, computed } from 'vue'
import { useRoute } from 'vue-router'
import Pagination from '@/components/Pagination.vue'
import DocPreviewModal from './DocPreviewModal.vue'
import type { Doc, PageResponse } from '@/types'

const route = useRoute()
const docs = ref<Doc[]>([])
const loading = ref(false)
const activeDocId = ref<string | null>(null)
const selectedDoc = ref<Doc | null>(null)
const showPreview = ref(false)

const pagination = ref({
  page: 1,
  size: 10,
  total: 0,
  pages: 0
})

const expertId = computed(() => route.params.expertId as string)

// åŠ è½½æ–‡æ¡£åˆ—è¡¨
const loadDocs = async (page: number = 1) => {
  if (!expertId.value) return
  
  loading.value = true
  try {
    // TODO: å®ç° docsApi
    // const response = await docsApi.getDocsByExpert(expertId.value, { page, size: 10 })
    // docs.value = response.items
    // pagination.value = { ...response }
  } catch (error) {
    console.error('Failed to load docs:', error)
  } finally {
    loading.value = false
  }
}

// è·å–å†…å®¹é¢„è§ˆï¼ˆå‰100å­—ç¬¦ï¼‰
const getPreview = (content: string) => {
  if (!content) return ''
  const text = content.replace(/[#*`\[\]]/g, '').trim()
  return text.length > 100 ? text.slice(0, 100) + '...' : text
}

// é€‰æ‹©æ–‡æ¡£
const selectDoc = (doc: Doc) => {
  activeDocId.value = doc.id
  selectedDoc.value = doc
  showPreview.value = true
}

// åˆ›å»ºæ–°æ–‡æ¡£
const createNewDoc = () => {
  selectedDoc.value = null
  showPreview.value = true
}

// å…³é—­é¢„è§ˆ
const closePreview = () => {
  showPreview.value = false
  selectedDoc.value = null
}

// ä¿å­˜æ–‡æ¡£
const saveDoc = async (doc: Partial<Doc>) => {
  // TODO: å®ç°ä¿å­˜é€»è¾‘
  console.log('Save doc:', doc)
  closePreview()
  loadDocs(pagination.value.page)
}

// åˆ†é¡µå˜åŒ–
const handlePageChange = (page: number) => {
  loadDocs(page)
}

// ç›‘å¬ expertId å˜åŒ–
watch(expertId, (newId) => {
  if (newId) loadDocs(1)
}, { immediate: true })

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (dateStr: string) => {
  const date = new Date(dateStr)
  return date.toLocaleDateString()
}
</script>

<style scoped>
.docs-tab {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 12px;
}

.docs-toolbar {
  margin-bottom: 12px;
}

.btn-new-doc {
  width: 100%;
  padding: 8px 12px;
  background: var(--primary-color, #2196f3);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.btn-new-doc:hover {
  background: var(--primary-hover, #1976d2);
}

.docs-list {
  flex: 1;
  overflow-y: auto;
}

.doc-card {
  padding: 12px;
  margin-bottom: 8px;
  background: var(--card-bg, #fff);
  border: 1px solid var(--border-color, #e0e0e0);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.doc-card:hover {
  border-color: var(--primary-color, #2196f3);
}

.doc-card.active {
  border-color: var(--primary-color, #2196f3);
  background: var(--primary-light, #e3f2fd);
}

.doc-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 8px;
}

.doc-title {
  font-size: 14px;
  font-weight: 600;
  margin: 0;
  color: var(--text-primary, #333);
}

.doc-status {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
}

.doc-status.draft {
  background: #fff3e0;
  color: #e65100;
}

.doc-status.final {
  background: #e8f5e9;
  color: #2e7d32;
}

.doc-status.archived {
  background: #f5f5f5;
  color: #757575;
}

.doc-preview {
  font-size: 12px;
  color: var(--text-secondary, #666);
  margin: 0 0 8px 0;
  line-height: 1.5;
}

.doc-meta {
  display: flex;
  gap: 12px;
  font-size: 11px;
  color: var(--text-tertiary, #999);
}

.empty-state {
  text-align: center;
  padding: 24px;
  color: var(--text-secondary, #666);
}

.empty-state .hint {
  font-size: 12px;
  color: var(--text-tertiary, #999);
  margin-top: 8px;
}
</style>
```

#### 6.4 Markdown æ¸²æŸ“

ä½¿ç”¨ `marked` åº“æ¸²æŸ“ Markdownï¼š

```bash
npm install marked
```

```typescript
// DocPreviewModal.vue ä¸­ä½¿ç”¨
import { marked } from 'marked'

const renderedContent = computed(() => {
  if (!props.doc?.content) return ''
  return marked(props.doc.content)
})
```

#### 6.5 åç«¯ API éœ€æ±‚

```
GET /api/docs?expert_id={expert_id}&page=1&size=10

Response:
{
  "items": [
    {
      "id": "uuid",
      "topic_id": "uuid",
      "expert_id": "uuid",
      "user_id": "uuid",
      "title": "æ–‡æ¡£æ ‡é¢˜",
      "content": "# Markdown å†…å®¹...",
      "content_type": "markdown",
      "status": "final",
      "version": 1,
      "tags": ["æŠ¥å‘Š", "è®¾è®¡"],
      "created_at": "2026-02-20T10:00:00Z",
      "updated_at": "2026-02-20T12:00:00Z"
    }
  ],
  "total": 10,
  "page": 1,
  "size": 10,
  "pages": 1
}

POST /api/docs
{
  "expert_id": "uuid",
  "topic_id": "uuid",
  "title": "æ–°æ–‡æ¡£",
  "content": "# å†…å®¹",
  "content_type": "markdown",
  "tags": ["æ ‡ç­¾"]
}

PUT /api/docs/:id
{
  "title": "æ›´æ–°æ ‡é¢˜",
  "content": "æ›´æ–°å†…å®¹",
  "status": "final"
}
```

#### 6.6 æ•°æ®åº“è¡¨è®¾è®¡

```sql
CREATE TABLE docs (
  id VARCHAR(32) PRIMARY KEY,
  topic_id VARCHAR(32) NOT NULL,
  expert_id VARCHAR(32) NOT NULL,
  user_id VARCHAR(32) NOT NULL,
  title VARCHAR(255) NOT NULL,
  content TEXT,
  content_type ENUM('markdown', 'code', 'text') DEFAULT 'markdown',
  status ENUM('draft', 'final', 'archived') DEFAULT 'draft',
  version INT DEFAULT 1,
  tags JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_topic_id (topic_id),
  INDEX idx_expert_id (expert_id),
  INDEX idx_user_id (user_id)
);
```

## å®ç°æ­¥éª¤

### Phase 1: åŸºç¡€ç»„ä»¶ï¼ˆ1 å¤©ï¼‰
1. åˆ›å»º `Pagination.vue` é€šç”¨åˆ†é¡µç»„ä»¶
2. åˆ›å»º `panel.ts` çŠ¶æ€ç®¡ç†
3. æ›´æ–° `types/index.ts` æ·»åŠ åˆ†é¡µç±»å‹å’Œ Doc ç±»å‹

### Phase 2: å³ä¾§é¢æ¿æ¡†æ¶ï¼ˆ1 å¤©ï¼‰
1. åˆ›å»º `RightPanel.vue` å®¹å™¨ç»„ä»¶
2. ä¿®æ”¹ `ChatView.vue` å¸ƒå±€ï¼Œé›†æˆå³ä¾§é¢æ¿
3. å®ç°å±•å¼€/æ”¶èµ·åŠ¨ç”»

### Phase 3: Docs Tabï¼ˆ1-2 å¤©ï¼‰
1. åˆ›å»º `DocsTab.vue` ç»„ä»¶
2. åˆ›å»º `DocPreviewModal.vue` é¢„è§ˆ/ç¼–è¾‘å¼¹çª—
3. åç«¯å®ç° docs API å’Œæ•°æ®åº“è¡¨

### Phase 4: Topics Tabï¼ˆ1-2 å¤©ï¼‰
1. åˆ›å»º `TopicsTab.vue` ç»„ä»¶
2. åç«¯å®ç° topics åˆ†é¡µ API
3. å‰ç«¯é›†æˆ API è°ƒç”¨

### Phase 5: Debug Tabï¼ˆ0.5 å¤©ï¼‰
1. è¿ç§» `DebugPanel` åˆ° `DebugTab`
2. è°ƒæ•´æ ·å¼é€‚é…é¢æ¿å®¹å™¨

---

*æ–‡æ¡£ç‰ˆæœ¬: v2.1*
*åˆ›å»ºæ—¥æœŸ: 2026-02-20*
*æ›´æ–°æ—¥æœŸ: 2026-02-21*
