# ä¸Šä¸‹æ–‡å‹ç¼©ä¸è¯é¢˜æ€»ç»“é‡æ„

**çŠ¶æ€ï¼š** ğŸ”„ è¿›è¡Œä¸­ï¼ˆåŸºç¡€è®¾æ–½å·²å®Œæˆï¼‰  
**ä¼˜å…ˆçº§ï¼š** é«˜  
**åˆ›å»ºæ—¥æœŸï¼š** 2026-02-22

## æè¿°

é‡æ„ä¸Šä¸‹æ–‡å‹ç¼©å’Œè¯é¢˜æ€»ç»“æœºåˆ¶ï¼Œè§£å†³å½“å‰å®ç°çš„é—®é¢˜ï¼š
- è¯é¢˜æ£€æµ‹é˜»å¡ä¸»å¯¹è¯æµç¨‹
- å½’æ¡£è§¦å‘è¿‡äºé¢‘ç¹ï¼ˆæ¯ 6 æ¡æ¶ˆæ¯ï¼‰
- æ–°æ¶ˆæ¯ç«‹å³åˆ†é… topic_idï¼Œæ— æ³•çœŸæ­£å‹ç¼©

## æ ¸å¿ƒæ”¹åŠ¨

1. **æ–°æ¶ˆæ¯ topic_id = NULL**ï¼šä¿å­˜æ¶ˆæ¯æ—¶ä¸åˆ†é…è¯é¢˜
2. **é˜ˆå€¼è§¦å‘å‹ç¼©**ï¼šToken >= é˜ˆå€¼ Ã— ä¸Šä¸‹æ–‡å¤§å°ï¼ˆå¦‚ 70% of 128kï¼‰
3. **æ‰¹é‡è¯é¢˜è¯†åˆ«**ï¼šå‹ç¼©æ—¶ 1 æ¬¡ LLM è°ƒç”¨è¯†åˆ«æ‰€æœ‰è¯é¢˜
4. **ä¸Šä¸‹æ–‡ç»“æ„**ï¼šSystem Prompt + Topic æ€»ç»“ + æœªå½’æ¡£æ¶ˆæ¯

---

## å·²å®Œæˆ

- [x] æ•°æ®åº“è¿ç§»ï¼šæ·»åŠ  `experts.context_threshold` å­—æ®µï¼ˆé»˜è®¤ 0.70ï¼‰
- [x] Sequelize æ¨¡å‹ï¼šé‡æ–°ç”Ÿæˆ `models/expert.js`
- [x] å‰ç«¯ç±»å‹ï¼š`types/index.ts` æ·»åŠ  `context_threshold` å­—æ®µ
- [x] è®¾ç½®ç•Œé¢ï¼š`SettingsView.vue` æ·»åŠ å‹ç¼©é˜ˆå€¼è¾“å…¥æ¡†
- [x] å›½é™…åŒ–ï¼šä¸­/è‹±æ–‡ç¿»è¯‘

---

## å¾…åŠ

- [ ] ä¿®æ”¹ `chat-service.js`ï¼šsaveUserMessage/saveAssistantMessage è®¾ç½® topic_id = NULL
- [ ] æ·»åŠ  `db.js`ï¼šgetUnarchivedMessages() æ–¹æ³•
- [ ] å®ç° `memory-system.js`ï¼šcompressContext() å‹ç¼©æµç¨‹
- [ ] ä¿®æ”¹ `memory-system.js`ï¼šbuildContext() åŠ è½½ Topic æ€»ç»“ + æœªå½’æ¡£æ¶ˆæ¯
- [ ] ç§»é™¤ `memory-system.js`ï¼šcheckAndHandleTopicShift() å’Œæ—§ processHistory é€»è¾‘

---

## ç›¸å…³æ–‡æ¡£

- [ä¸Šä¸‹æ–‡å‹ç¼©è®¾è®¡ v2](../design/v2/context-compression-design.md) â­ æ ¸å¿ƒè®¾è®¡
- [LLM è°ƒç”¨åœºæ™¯åˆ†æ](../design/v1/llm-call-scenarios.md) - 5 ç§ LLM è°ƒç”¨åœºæ™¯
- [åå°ä»»åŠ¡è°ƒåº¦å™¨è®¾è®¡](../design/v2/background-task-scheduler-design.md) - ä¸²è¡Œä»»åŠ¡æ‰§è¡Œ
