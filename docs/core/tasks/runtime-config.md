# 运行时参数配置界面

> 创建日期：2026-02-24
> 状态：⏳ 待开始
> 优先级：中

---

## 背景

目前系统中有多个运行时参数硬编码在代码中，需要在设置界面提供可视化配置。

---

## 需要配置的参数

### 1. 工具调用相关

| 参数名 | 当前值 | 位置 | 说明 |
|--------|--------|------|------|
| `maxLength` (工具结果截断) | 10000 | `lib/tool-manager.js:436` | 工具返回结果的最大字符数 |
| `SKILL_EXECUTION_TIMEOUT` | 30000 | `lib/skill-loader.js:25` | 技能执行超时（毫秒） |
| `SKILL_MEMORY_LIMIT` | 128 | `lib/skill-loader.js:27` | 技能子进程内存限制（MB） |
| `MAX_TOOL_ROUNDS` | 20 | `lib/chat-service.js:150` | 最大工具调用轮数 |

### 2. 上下文压缩相关

| 参数名 | 当前值 | 位置 | 说明 |
|--------|--------|------|------|
| `context_threshold` | 0.7 | 专家配置 | 触发压缩的上下文使用阈值 |
| `minMessages` | 20 | `lib/chat-service.js:131` | 触发压缩的最小消息数 |

### 3. LLM 调用相关

| 参数名 | 当前值 | 位置 | 说明 |
|--------|--------|------|------|
| `max_tokens` | 4096 | `lib/llm-client.js:143` | 默认最大生成 token 数 |
| `timeout` | 60s | `lib/llm-client.js:152` | 默认请求超时时间 |

### 4. 技能沙箱相关

| 参数名 | 当前值 | 位置 | 说明 |
|--------|--------|------|------|
| `MODULE_WHITELIST` | fs, path, http... | `lib/skill-runner.js:30` | 技能可用的模块白名单 |
| `vm timeout` | 10000 | `lib/skill-runner.js:121` | VM 沙箱执行超时（毫秒） |

---

## 设计方案

### 数据库

在 `experts` 表或新建 `system_config` 表存储这些配置。

### 前端界面

在设置界面添加「高级设置」或「运行时参数」标签页：

```
┌─────────────────────────────────────────────────────────────┐
│  设置 > 运行时参数                                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  工具调用                                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 工具结果最大长度: [10000] 字符                        │   │
│  │ 技能执行超时: [30000] 毫秒                           │   │
│  │ 技能内存限制: [128] MB                               │   │
│  │ 最大工具调用轮数: [20]                               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  上下文管理                                                  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 压缩阈值: [0.7] (0-1)                                │   │
│  │ 最小消息数: [20]                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [保存] [恢复默认]                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 实现步骤

1. [ ] 设计配置数据结构
2. [ ] 创建/修改数据库表
3. [ ] 后端 API 开发
4. [ ] 前端表单组件
5. [ ] 配置热更新（无需重启服务）

---

## 注意事项

- 部分参数修改后需要重启服务才能生效
- 需要参数校验（范围、类型）
- 敏感参数需要管理员权限
